# 基于深度学习的皮带传送带锚杆检测系统

## 系统概述

本系统是一个基于深度学习的皮带传送带锚杆检测系统，实现了视频流处理、模型通用接口、交互界面和后处理等完整功能。

## 主要功能

### 1. 输入视频流处理模块
- **视频文件支持**: 支持多种视频格式（MP4、AVI、FLV等）
- **摄像头实时检测**: 支持USB摄像头实时视频流检测
- **图像预处理**: 
  - 分辨率调整
  - 帧率控制
  - 图像增强（亮度、对比度、饱和度调整）

### 2. 模型通用接口
- **多模型格式支持**: 
  - ONNX模型（当前已实现）
  - PyTorch模型（接口预留，可扩展）
- **模型动态加载**: 支持运行时切换不同模型
- **参数可调**: 支持动态调整置信度和IOU阈值

### 3. 软件交互界面
- **数据输入**:
  - 图片文件检测
  - 视频文件检测
  - 摄像头实时检测
- **检测结果显示**:
  - 实时视频显示
  - 检测框和标签绘制
  - 检测结果统计（当前帧和累计统计）
- **后处理操作**:
  - 保存当前检测图像
  - 导出检测报告（TXT格式）
  - 导出CSV数据
  - 导出JSON数据
  - 清空检测历史记录

### 4. 后处理功能
- **结果保存**: 自动记录所有检测结果
- **统计信息**: 实时统计各类别检测数量
- **报告导出**: 支持多种格式导出（TXT、CSV、JSON）
- **历史记录**: 保存检测时间戳、帧ID、位置等信息

## 系统架构

```
皮带传送带锚杆检测系统
├── main.py                 # 主程序，GUI界面
├── model_interface.py      # 通用模型接口模块
├── video_processor.py      # 视频预处理模块
├── post_processor.py       # 后处理模块
├── Yolov5OnnxruntimeDet.py # YOLOv5 ONNX检测器（兼容旧代码）
├── yolov5_utils.py         # YOLOv5工具函数
└── weights/                # 模型权重目录
    ├── yolov5s.onnx       # ONNX模型文件
    └── class_names.txt     # 类别名称文件
```

## 安装依赖

```bash
pip install PyQt5
pip install opencv-python
pip install numpy
pip install torch
pip install onnxruntime
pip install torchvision
```

## 使用方法

### 1. 准备模型文件
将训练好的ONNX模型文件放入 `weights/` 目录，确保 `class_names.txt` 文件存在。

### 2. 运行程序
```bash
python main.py
```

### 3. 使用步骤
1. **选择模型**: 在界面左侧下拉框中选择要使用的模型
2. **调整参数**: 
   - 调整置信度阈值（0.0-1.0）
   - 调整IOU阈值（0.0-1.0）
3. **开始检测**:
   - 点击"选择图片"进行图片检测
   - 点击"选择视频"进行视频文件检测
   - 点击"打开摄像头"进行实时检测
4. **查看结果**: 在右侧结果统计区域查看检测结果
5. **导出结果**: 
   - 点击"保存当前图像"保存当前检测图像
   - 点击"导出报告"导出TXT格式报告
   - 点击"导出CSV"导出CSV格式数据
   - 通过菜单栏"文件"->"导出JSON"导出JSON格式数据

## 技术特点

1. **模块化设计**: 采用模块化架构，便于扩展和维护
2. **通用接口**: 提供统一的模型接口，支持多种模型格式
3. **实时处理**: 支持实时视频流检测，帧率可控
4. **完整记录**: 自动记录所有检测结果，支持多种格式导出
5. **用户友好**: 直观的GUI界面，操作简便

## 扩展说明

### 添加新的模型支持
1. 在 `model_interface.py` 中继承 `BaseDetector` 类
2. 实现 `load_model()` 和 `inference_image()` 方法
3. 在 `create_detector()` 函数中添加模型类型判断

### 自定义预处理
在 `video_processor.py` 的 `process_frame()` 方法中添加自定义预处理逻辑。

### 自定义后处理
在 `post_processor.py` 中添加新的导出格式或处理功能。

## 注意事项

1. 确保模型文件格式正确，类别名称文件与模型匹配
2. 首次运行时会自动加载模型，可能需要一些时间
3. 检测过程中可以动态调整置信度和IOU阈值
4. 导出功能需要先进行检测，有检测记录才能导出

## 系统要求

- Python 3.7+
- Windows/Linux/MacOS
- 支持CUDA的GPU（可选，用于加速推理）

## 许可证

本项目仅供学习和研究使用。
